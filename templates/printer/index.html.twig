{% extends 'base.html.twig' %}

{% block title %}{{ 'app.printer.index.title'|trans }} | {{ parent() }}{% endblock %}

{% block body %}
	<h2>{{ 'app.printer.index.heading'|trans }}</h2>

	<table class="table">
		<colgroup>
			<col />
			<col />
			<col />
			<col />
			<col class="col-1" />
			<col class="col-1" />
		</colgroup>
		<thead>
			<tr>
				<th>{{ 'app.fields.printer.model.label'|trans }}</th>
				<th><abbr title="{{ 'app.fields.printer.api.label.long'|trans }}">{{ 'app.fields.printer.api.label.short'|trans }}</abbr></th>
				<th>{{ 'app.fields.printer.location.label'|trans }}</th>
				<th>{{ 'app.fields.id'|trans }}</th>
				<th><abbr title="{{ 'app.fields.printer.status.label.long'|trans }}">{{ 'app.fields.printer.status.label.short'|trans }}</abbr></th>
				<th><a href="{{ path('printer_new') }}" class="btn btn-success" class="btn btn-success" title="{{ 'global.action.new'|trans }}" aria-label="{{ 'global.action.new'|trans }}">‚ûï</a></th>
			</tr>
		</thead>
		<tbody>
		{% for printer in printers %}
			<tr>
				<td>{{ printer.model }}</td>
				<td>{{ printer.api.value|humanize }}</td>
				<td>{% if not printer.status is same as(printer.status.STORED) -%}
					<button class="btn btn-sm btn-outline-secondary" title="{{ 'app.printer.show.connect'|trans }}" aria-label="{{ 'app.printer.show.connect'|trans }}" data-bs-toggle="modal" data-bs-target="#Modal" data-qrcode-data="http://{{ printer.ip }}/">üîó</button>
					{% if printer.location -%}
					<abbr title="{{ printer.ip ~ ' | ' ~ printer.port }}">üåê</abbr> {{ printer.location.name }}
					{%- else -%}
						{{ printer.ip ~ ' | ' ~ printer.port }}
					{% endif %}
					{%- else -%}
						<i>{{ 'app.fields.printer.location.unspecified'|trans }}</i>
					{%- endif -%}</td>
				<td>{{ printer.id }}</td>
				<td><abbr title="{{ ('app.fields.printer.status.' ~ printer.status.value ~ '.label.long')|trans }}">{{ printer.status|trans }}</abbr></td>
				<td>
					<a href="{{ path('printer_show', {'id': printer.id}) }}" class="btn btn-sm btn-outline-info" title="{{ 'global.action.show'|trans }}" aria-label="{{ 'global.action.show'|trans }}">üëÅÔ∏è</a>
					<a href="{{ path('printer_edit', {'id': printer.id}) }}" class="btn btn-sm btn-outline-warning" title="{{ 'global.action.edit'|trans }}" aria-label="{{ 'global.action.edit'|trans }}">‚úèÔ∏è</a>
				</td>
			</tr>
		{% else %}
			<tr>
				<td colspan="6">{{ 'app.printer.index.none'|trans }}</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endblock %}

{% block javascripts %}
		<script src="{{ assets_host }}/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script>/*<![CDATA[*/
		document.addEventListener('DOMContentLoaded', () => {
			document.addEventListener('show.bs.modal', async function(e) {
				if (e.relatedTarget.localName == 'button' && e.relatedTarget.dataset.qrcodeData) {
					e.target.querySelector('.modal-dialog.modal-xl').classList.remove('modal-xl');
					const modalContent = document.querySelector('.modal-content');
					while(modalContent.firstChild) modalContent.removeChild(modalContent.firstChild);
					const codeContainer = document.createElement('div');
					codeContainer.classList.add('modal-body', 'text-center');
					modalContent.append(codeContainer);
					const qrcode = new QRCode(codeContainer, {
						useSVG: true
					});
					qrcode.makeCode(e.relatedTarget.dataset.qrcodeData);
					codeContainer.querySelector('img').classList.add('mx-auto');
				}
			});

			document.addEventListener('hidden.bs.modal', function(e) {
				const target = e.target.querySelector('.modal-content');
				target.innerHTML = target.dataset.emptyContent;
				if (!e.target.querySelector('.modal-xl')) {
					e.target.querySelector('.modal-dialog').classList.add('modal-xl');
				}
			});
		});
		/*]]*/</script>
{% endblock %}
